<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>Action: Tracing and Debugging MLIR-based Compilers - MLIR</title><meta name=description content="Multi-Level IR Compiler Framework"><meta name=generator content="Hugo 0.119.0"><link href=https://mlir.llvm.org/index.xml rel=alternate type=application/rss+xml><link rel=canonical href=https://mlir.llvm.org/docs/ActionTracing/><link rel=stylesheet href=https://mlir.llvm.org/css/theme.css><script src=https://use.fontawesome.com/releases/v5.0.6/js/all.js></script>
<link rel=stylesheet href=https://mlir.llvm.org/css/chroma.min.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js></script>
<script src=https://mlir.llvm.org/js/bundle.js></script>
<script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$', '$'] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
    }
  });
</script><link rel=apple-touch-icon sizes=180x180 href="/apple-touch-icon.png?v=1"><link rel=icon type=image/png sizes=32x32 href="/favicon-32x32.png?v=1"><link rel=icon type=image/png sizes=16x16 href="/favicon-16x16.png?v=1"><link rel=manifest href="/site.webmanifest?v=1"><link rel=mask-icon href="/safari-pinned-tab.svg?v=1" color=#3775e0><link rel="shortcut icon" href="/favicon.ico?v=1"><meta name=msapplication-TileColor content="#2d89ef"><meta name=theme-color content="#ffffff"><link rel=icon href=/favicon.svg type=image/svg+xml sizes=any><style>:root{}</style></head><body><div class=container><header><h1><div><img src=https://mlir.llvm.org//mlir-logo.png width=40px align=absmiddle>
MLIR</div></h1><p class=description>Multi-Level IR Compiler Framework</p></header><div class=global-menu><nav><ul><li class=parent><a href>Community<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=https://llvm.discourse.group/c/mlir/31>Forums</a></li><li class=child><a href=https://discord.gg/xS7Z362>Chat</a></li></ul></li><li><a href=/getting_started/Debugging/>Debugging Tips</a></li><li><a href=/getting_started/Faq/>FAQ</a></li><li class=parent><a href=https://github.com/llvm/llvm-project/tree/main/mlir>Source<i class="fas fa-angle-right"></i></a><ul class=sub-menu><li class=child><a href=/doxygen/>Doxygen</a></li><li class=child><a href=https://github.com/llvm/llvm-project/tree/main/mlir>GitHub</a></li></ul></li><li><a href="https://github.com/llvm/llvm-project/issues?q=is%3Aissue%20state%3Aopen%20label%3Amlir">Bugs</a></li><li><a href=https://github.com/llvm/mlir-www/tree/main/website/static/LogoAssets>Logo Assets</a></li><li><a href=https://www.youtube.com/MLIRCompiler>Youtube Channel</a></li></ul></nav></div><div class=content-container><main><h1>Action: Tracing and Debugging MLIR-based Compilers</h1><p><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#wrapping-a-transformation-in-an-action>Wrapping a Transformation in an Action</a></li><li><a href=#intercepting-actions>Intercepting Actions</a></li><li><a href=#mlir-provided-handlers>MLIR-provided Handlers</a><ul><li><a href=#debug-counters>Debug Counters</a></li><li><a href=#executioncontext>ExecutionContext</a></li></ul></li></ul></nav><p>See also the
<a href=https://mlir.llvm.org/OpenMeetings/2023-02-23-Actions.pdf>slides</a>
and the
<a href=https://youtu.be/ayQSyekVa3c>recording</a> from the MLIR Open Meeting
where this feature was demoed.</p><h2 id=overview>Overview&nbsp;<a class=headline-hash href=#overview>¶</a></h2><p><code>Action</code> are means to encapsulate any transformation of any granularity in a way
that can be intercepted by the framework for debugging or tracing purposes,
including skipping a transformation programmatically (think about &ldquo;compiler
fuel&rdquo; or &ldquo;debug counters&rdquo; in LLVM). As such, &ldquo;executing a pass&rdquo; is an Action, so
is &ldquo;try to apply one canonicalization pattern&rdquo;, or &ldquo;tile this loop&rdquo;.</p><p>In MLIR, passes and patterns are the main abstractions to encapsulate general IR
transformations. The primary way of observing transformations along the way is
to enable “debug printing” of the IR (e.g. -mlir-print-ir-after-all to print
after each pass execution). On top of this, finer grain tracing may be available
with -debug which enables more detailed logs from the transformations
themselves. However, this method has some scaling issues: it is limited to a
single stream of text that can be gigantic and requires tedious crawling through
this log a posteriori. Iterating through multiple runs of collecting such logs
and analyzing it can be very time consuming and often not very practical beyond
small input programs.</p><p>The <code>Action</code> framework doesn&rsquo;t make any assumptions about how the higher level
driver is controlling the execution, it merely provides a framework for
connecting the two together. A high level overview of the workflow surrounding
<code>Action</code> execution is shown below:</p><ul><li>Compiler developer defines an <code>Action</code> class, that is representing the
transformation or utility that they are developing.</li><li>Depending on the needs, the developer identifies single unit of
transformations, and dispatch them to the <code>MLIRContext</code> for execution.</li><li>An external entity registers an &ldquo;action handler&rdquo; with the action manager, and
provides the logic surrounding the transformation execution.</li></ul><p>The exact definition of an <code>external entity</code> is left opaque, to allow for more
interesting handlers.</p><h2 id=wrapping-a-transformation-in-an-action>Wrapping a Transformation in an Action&nbsp;<a class=headline-hash href=#wrapping-a-transformation-in-an-action>¶</a></h2><p>There are two parts for getting started with enabling tracing through Action in
existing or new code: 1) defining an actual <code>Action</code> class, and 2) encapsulating
the transformation in a lambda function.</p><p>There are no constraints on the granularity of an “action”, it can be as simple
as “perform this fold” and as complex as “run this pass pipeline”. An action is
comprised of the following:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>/// A custom Action can be defined minimally by deriving from
</span></span></span><span class=line><span class=cl><span class=c1>/// `tracing::ActionImpl`.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>MyCustomAction</span> <span class=o>:</span> <span class=k>public</span> <span class=n>tracing</span><span class=o>::</span><span class=n>ActionImpl</span><span class=o>&lt;</span><span class=n>MyCustomAction</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>Base</span> <span class=o>=</span> <span class=n>tracing</span><span class=o>::</span><span class=n>ActionImpl</span><span class=o>&lt;</span><span class=n>MyCustomAction</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>/// Actions are initialized with an array of IRUnit (that is either Operation,
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>/// Block, or Region) that provide context for the IR affected by a transformation.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>MyCustomAction</span><span class=p>(</span><span class=n>ArrayRef</span><span class=o>&lt;</span><span class=n>IRUnit</span><span class=o>&gt;</span> <span class=n>irUnits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>Base</span><span class=p>(</span><span class=n>irUnits</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=c1>/// This tag should uniquely identify this action, it can be matched for filtering
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>/// during processing.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static</span> <span class=k>constexpr</span> <span class=n>StringLiteral</span> <span class=n>tag</span> <span class=o>=</span> <span class=s>&#34;unique-tag-for-my-action&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=n>StringLiteral</span> <span class=n>desc</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;This action will encapsulate a some very specific transformation&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>Any transformation can then be dispatched with this <code>Action</code> through the
<code>MLIRContext</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>context</span><span class=o>-&gt;</span><span class=n>executeAction</span><span class=o>&lt;</span><span class=n>ApplyPatternAction</span><span class=o>&gt;</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=o>&amp;</span><span class=p>]()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>rewriter</span><span class=p>.</span><span class=n>setInsertionPoint</span><span class=p>(</span><span class=n>op</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*IRUnits=*/</span><span class=p>{</span><span class=n>op</span><span class=p>,</span> <span class=n>region</span><span class=p>});</span>
</span></span></code></pre></div><p>An action can also carry arbitrary payload, for example we can extend the
<code>MyCustomAction</code> class above with the following member:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>/// A custom Action can be defined minimally by deriving from
</span></span></span><span class=line><span class=cl><span class=c1>/// `tracing::ActionImpl`. It can have any members!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>class</span> <span class=nc>MyCustomAction</span> <span class=o>:</span> <span class=k>public</span> <span class=n>tracing</span><span class=o>::</span><span class=n>ActionImpl</span><span class=o>&lt;</span><span class=n>MyCustomAction</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>  <span class=k>using</span> <span class=n>Base</span> <span class=o>=</span> <span class=n>tracing</span><span class=o>::</span><span class=n>ActionImpl</span><span class=o>&lt;</span><span class=n>MyCustomAction</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>/// Actions are initialized with an array of IRUnit (that is either Operation,
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>/// Block, or Region) that provide context for the IR affected by a transformation.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>/// Other constructor arguments can also be required here.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>MyCustomAction</span><span class=p>(</span><span class=n>ArrayRef</span><span class=o>&lt;</span><span class=n>IRUnit</span><span class=o>&gt;</span> <span class=n>irUnits</span><span class=p>,</span> <span class=kt>int</span> <span class=n>count</span><span class=p>,</span> <span class=n>PaddingStyle</span> <span class=n>padding</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=o>:</span> <span class=n>Base</span><span class=p>(</span><span class=n>irUnits</span><span class=p>),</span> <span class=n>count</span><span class=p>(</span><span class=n>count</span><span class=p>),</span> <span class=n>padding</span><span class=p>(</span><span class=n>padding</span><span class=p>)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=c1>/// This tag should uniquely identify this action, it can be matched for filtering
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>/// during processing.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>static</span> <span class=k>constexpr</span> <span class=n>StringLiteral</span> <span class=n>tag</span> <span class=o>=</span> <span class=s>&#34;unique-tag-for-my-action&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>static</span> <span class=k>constexpr</span> <span class=n>StringLiteral</span> <span class=n>desc</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;This action will encapsulate a some very specific transformation&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=c1>/// Extra members can be carried by the Action
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>count</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>PaddingStyle</span> <span class=n>padding</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>These new members must then be passed as arguments when dispatching an <code>Action</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>context</span><span class=o>-&gt;</span><span class=n>executeAction</span><span class=o>&lt;</span><span class=n>ApplyPatternAction</span><span class=o>&gt;</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=o>&amp;</span><span class=p>]()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>rewriter</span><span class=p>.</span><span class=n>setInsertionPoint</span><span class=p>(</span><span class=n>op</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*IRUnits=*/</span><span class=p>{</span><span class=n>op</span><span class=p>,</span> <span class=n>region</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*count=*/</span><span class=n>count</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*padding=*/</span><span class=n>padding</span><span class=p>);</span>
</span></span></code></pre></div><h2 id=intercepting-actions>Intercepting Actions&nbsp;<a class=headline-hash href=#intercepting-actions>¶</a></h2><p>When a transformation is executed through an <code>Action</code>, it can be directly
intercepted via a handler that can be set on the <code>MLIRContext</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl>  <span class=c1>/// Signatures for the action handler that can be registered with the context.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>using</span> <span class=n>HandlerTy</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=n>std</span><span class=o>::</span><span class=n>function</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>(</span><span class=n>function_ref</span><span class=o>&lt;</span><span class=kt>void</span><span class=p>()</span><span class=o>&gt;</span><span class=p>,</span> <span class=k>const</span> <span class=n>tracing</span><span class=o>::</span><span class=n>Action</span> <span class=o>&amp;</span><span class=p>)</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>/// Register a handler for handling actions that are dispatched through this
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>/// context. A nullptr handler can be set to disable a previously set handler.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>void</span> <span class=nf>registerActionHandler</span><span class=p>(</span><span class=n>HandlerTy</span> <span class=n>handler</span><span class=p>);</span>
</span></span></code></pre></div><p>This handler takes two arguments: the first on is the transformation wrapped in
a callback, and the second is a reference to the associated action object. The
handler has full control of the execution, as such it can also decide to return
without executing the callback, skipping the transformation entirely!</p><h2 id=mlir-provided-handlers>MLIR-provided Handlers&nbsp;<a class=headline-hash href=#mlir-provided-handlers>¶</a></h2><p>MLIR provides some predefined action handlers for immediate use that are
believed to be useful for most projects built with MLIR.</p><h3 id=debug-counters>Debug Counters&nbsp;<a class=headline-hash href=#debug-counters>¶</a></h3><p>When debugging a compiler issue,
<a href=https://en.wikipedia.org/wiki/Bisection_%28software_engineering%29>&ldquo;bisection&rdquo;</a>
is a useful technique for locating the root cause of the issue. <code>Debug Counters</code>
enable using this technique for debug actions by attaching a counter value to a
specific action and enabling/disabling execution of this action based on the
value of the counter. The counter controls the execution of the action with a
&ldquo;skip&rdquo; and &ldquo;count&rdquo; value. The &ldquo;skip&rdquo; value is used to skip a certain number of
initial executions of a debug action. The &ldquo;count&rdquo; value is used to prevent a
debug action from executing after it has executed for a set number of times (not
including any executions that have been skipped). If the &ldquo;skip&rdquo; value is
negative, the action will always execute. If the &ldquo;count&rdquo; value is negative, the
action will always execute after the &ldquo;skip&rdquo; value has been reached. For example,
a counter for a debug action with <code>skip=47</code> and <code>count=2</code>, would skip the first
47 executions, then execute twice, and finally prevent any further executions.
With a bit of tooling, the values to use for the counter can be automatically
selected; allowing for finding the exact execution of a debug action that
potentially causes the bug being investigated.</p><p>Note: The DebugCounter action handler does not support multi-threaded execution,
and should only be used in MLIRContexts where multi-threading is disabled (e.g.
via <code>-mlir-disable-threading</code>).</p><h4 id=commandline-configuration>CommandLine Configuration&nbsp;<a class=headline-hash href=#commandline-configuration>¶</a></h4><p>The <code>DebugCounter</code> handler provides several that allow for configuring counters.
The main option is <code>mlir-debug-counter</code>, which accepts a comma separated list of
<code>&lt;count-name>=&lt;counter-value></code>. A <code>&lt;counter-name></code> is the debug action tag to
attach the counter, suffixed with either <code>-skip</code> or <code>-count</code>. A <code>-skip</code> suffix
will set the &ldquo;skip&rdquo; value of the counter. A <code>-count</code> suffix will set the &ldquo;count&rdquo;
value of the counter. The <code>&lt;counter-value></code> component is a numeric value to use
for the counter. An example is shown below using <code>MyCustomAction</code> defined above:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ mlir-opt foo.mlir -mlir-debug-counter<span class=o>=</span>unique-tag-for-my-action-skip<span class=o>=</span>47,unique-tag-for-my-action-count<span class=o>=</span><span class=m>2</span>
</span></span></code></pre></div><p>The above configuration would skip the first 47 executions of
<code>ApplyPatternAction</code>, then execute twice, and finally prevent any further
executions.</p><p>Note: Each counter currently only has one <code>skip</code> and one <code>count</code> value, meaning
that sequences of <code>skip</code>/<code>count</code> will not be chained.</p><p>The <code>mlir-print-debug-counter</code> option may be used to print out debug counter
information after all counters have been accumulated. The information is printed
in the following format:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>DebugCounter counters:
</span></span><span class=line><span class=cl>&lt;action-tag&gt;                   : <span class=o>{</span>&lt;current-count&gt;,&lt;skip&gt;,&lt;count&gt;<span class=o>}</span>
</span></span></code></pre></div><p>For example, using the options above we can see how many times an action is
executed:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ mlir-opt foo.mlir -mlir-debug-counter<span class=o>=</span>unique-tag-for-my-action-skip<span class=o>=</span>-1 -mlir-print-debug-counter --pass-pipeline<span class=o>=</span><span class=s2>&#34;builtin.module(func.func(my-pass))&#34;</span> --mlir-disable-threading
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>DebugCounter counters:
</span></span><span class=line><span class=cl>unique-tag-for-my-action         : <span class=o>{</span>370,-1,-1<span class=o>}</span>
</span></span></code></pre></div><h3 id=executioncontext>ExecutionContext&nbsp;<a class=headline-hash href=#executioncontext>¶</a></h3><p>The <code>ExecutionContext</code> is a component that provides facility to unify the kind
of functionalities that most compiler debuggers tool would need, exposed in a
composable way.</p><p><img src=/actions/ActionTracing_ExecutionContext.png alt=IMG></p><p>The <code>ExecutionContext</code> is itself registered as a handler with the MLIRContext
and tracks all executed actions, keeping a per-thread stack of action execution.
It acts as a middleware that handles the flow of action execution while allowing
injection and control from a debugger.</p><ul><li>Multiple <code>Observers</code> can be registered with the <code>ExecutionContext</code>. When an
action is dispatched for execution, it is passed to each of the <code>Observers</code>
before and after executing the transformation.</li><li>Multiple <code>BreakpointManager</code> can be registered with the <code>ExecutionContext</code>.
When an action is dispatched for execution, it is passed to each of the
registered <code>BreakpointManager</code> until one matches the action and return a valid
<code>Breakpoint</code> object. In this case, the &ldquo;callback&rdquo; set by the client on the
<code>ExecutionContext</code> is invoked, otherwise the transformation is directly
executed.</li><li>A single callback:
<code>using CallbackTy = function_ref&lt;Control(const ActionActiveStack *)>;</code> can be
registered with the <code>ExecutionContext</code>, it is invoked when a <code>BreakPoint</code> is
hit by an <code>Action</code>. The returned value of type <code>Control</code> is an enum
instructing the <code>ExecutionContext</code> of how to proceed next:<div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>/// Enum that allows the client of the context to control the execution of the
</span></span></span><span class=line><span class=cl><span class=c1>/// action.
</span></span></span><span class=line><span class=cl><span class=c1>/// - Apply: The action is executed.
</span></span></span><span class=line><span class=cl><span class=c1>/// - Skip: The action is skipped.
</span></span></span><span class=line><span class=cl><span class=c1>/// - Step: The action is executed and the execution is paused before the next
</span></span></span><span class=line><span class=cl><span class=c1>///         action, including for nested actions encountered before the
</span></span></span><span class=line><span class=cl><span class=c1>///         current action finishes.
</span></span></span><span class=line><span class=cl><span class=c1>/// - Next: The action is executed and the execution is paused after the
</span></span></span><span class=line><span class=cl><span class=c1>///         current action finishes before the next action.
</span></span></span><span class=line><span class=cl><span class=c1>/// - Finish: The action is executed and the execution is paused only when we
</span></span></span><span class=line><span class=cl><span class=c1>///           reach the parent/enclosing operation. If there are no enclosing
</span></span></span><span class=line><span class=cl><span class=c1>///           operation, the execution continues without stopping.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>enum</span> <span class=nc>Control</span> <span class=p>{</span> <span class=n>Apply</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>Skip</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span> <span class=n>Step</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span> <span class=n>Next</span> <span class=o>=</span> <span class=mi>4</span><span class=p>,</span> <span class=n>Finish</span> <span class=o>=</span> <span class=mi>5</span> <span class=p>};</span>
</span></span></code></pre></div>Since the callback actually controls the execution, there can be only one
registered at any given time.</li></ul><h4 id=debugger-executioncontext-hook>Debugger ExecutionContext Hook&nbsp;<a class=headline-hash href=#debugger-executioncontext-hook>¶</a></h4><p>MLIR provides a callback for the <code>ExecutionContext</code> that implements a small
runtime suitable for debuggers like <code>gdb</code> or <code>lldb</code> to interactively control the
execution. It can be setup with
<code>mlir::setupDebuggerExecutionContextHook(executionContext);</code> or using <code>mlir-opt</code>
with the <code>--mlir-enable-debugger-hook</code> flag. This runtime exposes a set of C API
function that can be called from a debugger to:</p><ul><li>set breakpoints matching either action tags, or the <code>FileLineCol</code> locations of
the IR associated with the action.</li><li>set the <code>Control</code> flag to be returned to the <code>ExecutionContext</code>.</li><li>control a &ldquo;cursor&rdquo; allowing to navigate through the IR and inspect it from the
IR context associated with the action.</li></ul><p>The implementation of this runtime can serve as an example for other
implementation of programmatic control of the execution.</p><h4 id=logging-observer>Logging Observer&nbsp;<a class=headline-hash href=#logging-observer>¶</a></h4><p>One observer is provided that allows to log action execution on a provided
stream. It can be exercised with <code>mlir-opt</code> using <code>--log-actions-to=&lt;filename></code>,
and optionally filtering the output with
<code>--log-mlir-actions-filter=&lt;FileLineCol></code>. This observer is not thread-safe at
the moment.</p><div class=edit-meta><br></div><nav class=pagination><a class="nav nav-prev" href=https://mlir.llvm.org/docs/TargetLLVMIRTransforms/ title><i class="fas fa-arrow-left" aria-hidden=true></i> Prev -</a>
<a class="nav nav-next" href=https://mlir.llvm.org/docs/Bufferization/ title=Bufferization>Next - Bufferization <i class="fas fa-arrow-right" aria-hidden=true></i></a></nav><footer><p class=powered>Powered by <a href=https://gohugo.io>Hugo</a>. Theme by <a href=https://themes.gohugo.io/hugo-theme-techdoc/>TechDoc</a>. Designed by <a href=https://github.com/thingsym/hugo-theme-techdoc>Thingsym</a>.</p></footer></main><div class=sidebar><nav class=slide-menu><ul><li><a href=https://mlir.llvm.org/>Home</a></li><li><a href=https://mlir.llvm.org/governance/>Governance</a></li><li><a href=https://mlir.llvm.org/users/>Users of MLIR</a></li><li><a href=https://mlir.llvm.org/pubs/>MLIR Related Publications</a></li><li><a href=https://mlir.llvm.org/talks/>Talks</a></li><li><a href=https://mlir.llvm.org/deprecation/>Deprecations & Current Refactoring</a></li><li class=has-sub-menu><a href=https://mlir.llvm.org/getting_started/>Getting Started<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/getting_started/ReportingIssues/>Reporting Issues</a></li><li><a href=https://mlir.llvm.org/getting_started/Debugging/>Debugging Tips</a></li><li><a href=https://mlir.llvm.org/getting_started/Faq/>FAQ</a></li><li><a href=https://mlir.llvm.org/getting_started/Contributing/>How to Contribute</a></li><li><a href=https://mlir.llvm.org/getting_started/DeveloperGuide/>Developer Guide</a></li><li><a href=https://mlir.llvm.org/getting_started/openprojects/>Open Projects</a></li><li><a href=https://mlir.llvm.org/getting_started/Glossary/>Glossary</a></li><li><a href=https://mlir.llvm.org/getting_started/TestingGuide/>Testing Guide</a></li></ul></li><li class="parent has-sub-menu"><a href=https://mlir.llvm.org/docs/>Code Documentation<span class="mark opened">-</span></a><ul class=sub-menu><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Bindings/>Bindings<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Bindings/Python/>MLIR Python Bindings</a></li></ul></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Tools/>Tools<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Tools/MLIRLSP/>MLIR : Language Server Protocol</a></li><li><a href=https://mlir.llvm.org/docs/Tools/mlir-reduce/>MLIR Reduce</a></li><li><a href=https://mlir.llvm.org/docs/Tools/mlir-rewrite/>mlir-rewrite</a></li></ul></li><li><a href=https://mlir.llvm.org/docs/TargetLLVMIRTransforms/></a></li><li class=active><a href=https://mlir.llvm.org/docs/ActionTracing/>Action: Tracing and Debugging MLIR-based Compilers</a></li><li><a href=https://mlir.llvm.org/docs/Bufferization/>Bufferization</a></li><li><a href=https://mlir.llvm.org/docs/DataLayout/>Data Layout Modeling</a></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/DefiningDialects/>Defining Dialects<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/DefiningDialects/Constraints/>Constraints</a></li><li><a href=https://mlir.llvm.org/docs/DefiningDialects/Assembly/>Customizing Assembly Behavior</a></li><li><a href=https://mlir.llvm.org/docs/DefiningDialects/AttributesAndTypes/>Defining Dialect Attributes and Types</a></li><li><a href=https://mlir.llvm.org/docs/DefiningDialects/Operations/>Operation Definition Specification (ODS)</a></li></ul></li><li><a href=https://mlir.llvm.org/docs/Diagnostics/>Diagnostic Infrastructure</a></li><li><a href=https://mlir.llvm.org/docs/DialectConversion/>Dialect Conversion</a></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Dialects/>Dialects<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Dialects/SMTExtensionOps/></a></li><li><a href=https://mlir.llvm.org/docs/Dialects/OpenACCDialect/>'acc' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/Affine/>'affine' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/AMDGPU/>'amdgpu' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/AMX/>'amx' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/ArithOps/>'arith' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/ArmNeon/>'arm_neon' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/ArmSVE/>'arm_sve' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/ArmSME/>'ArmSME' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/AsyncDialect/>'async' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/BufferizationOps/>'bufferization' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/ControlFlowDialect/>'cf' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/ComplexOps/>'complex' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/DLTIDialect/>'dlti' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/EmitC/>'emitc' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/Func/>'func' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/GPU/>'gpu' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/IndexOps/>'index' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/IRDL/>'irdl' Dialect</a></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Dialects/Linalg/>'linalg' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Dialects/Linalg/OpDSL/>Linalg OpDSL</a></li></ul></li><li><a href=https://mlir.llvm.org/docs/Dialects/LLVM/>'llvm' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/MathOps/>'math' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/MemRef/>'memref' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/MLProgramOps/>'ml_program' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/MPI/>'mpi' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/NVGPU/>'nvgpu' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/NVVMDialect/>'nvvm' Dialect</a></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Dialects/OpenMPDialect/>'omp' Dialect<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Dialects/OpenMPDialect/ODS/>ODS Documentation</a></li></ul></li><li><a href=https://mlir.llvm.org/docs/Dialects/PDLInterpOps/>'pdl_interp' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/PDLOps/>'pdl' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/PtrOps/>'ptr' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/QuantDialect/>'quant' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/ROCDLDialect/>'rocdl' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/SCFDialect/>'scf' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/ShapeDialect/>'shape' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/Shard/>'shard' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/SMT/>'smt' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/SparseTensorOps/>'sparse_tensor' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/TensorOps/>'tensor' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/UBOps/>'ub' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/VCIXDialect/>'vcix' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/Vector/>'vector' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/WasmSSAOps/>'wasmssa' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/X86Vector/>'x86vector' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/XeGPU/>'xegpu' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/XeVMDialect/>'xevm' Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/Builtin/>Builtin Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/MatchOpInterfaces/>OpInterface definitions</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/SPIR-V/>SPIR-V Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/TOSA/>Tensor Operator Set Architecture (TOSA) Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Dialects/Transform/>Transform Dialect</a></li></ul></li><li><a href=https://mlir.llvm.org/docs/Interfaces/>Interfaces</a></li><li><a href=https://mlir.llvm.org/docs/TargetLLVMIR/>LLVM IR Target</a></li><li><a href=https://mlir.llvm.org/docs/BytecodeFormat/>MLIR Bytecode Format</a></li><li><a href=https://mlir.llvm.org/docs/CAPI/>MLIR C API</a></li><li><a href=https://mlir.llvm.org/docs/LangRef/>MLIR Language Reference</a></li><li><a href=https://mlir.llvm.org/docs/ReleaseNotes/>MLIR Release Notes</a></li><li><a href=https://mlir.llvm.org/docs/Canonicalization/>Operation Canonicalization</a></li><li><a href=https://mlir.llvm.org/docs/OwnershipBasedBufferDeallocation/>Ownership-based Buffer Deallocation</a></li><li><a href=https://mlir.llvm.org/docs/PassManagement/>Pass Infrastructure</a></li><li><a href=https://mlir.llvm.org/docs/Passes/>Passes</a></li><li><a href=https://mlir.llvm.org/docs/PatternRewriter/>Pattern Rewriting : Generic DAG-to-DAG Rewriting</a></li><li><a href=https://mlir.llvm.org/docs/PatternSearch/>Pattern Search</a></li><li><a href=https://mlir.llvm.org/docs/PDLL/>PDLL - PDL Language</a></li><li><a href=https://mlir.llvm.org/docs/Quantization/>Quantization</a></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Rationale/>Rationale<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Rationale/RationaleGenericDAGRewriter/>Generic DAG Rewriter Infrastructure Rationale</a></li><li><a href=https://mlir.llvm.org/docs/Rationale/RationaleLinalgDialect/>Linalg Dialect Rationale: The Case For Compiler-Friendly Custom Operations</a></li><li><a href=https://mlir.llvm.org/docs/Rationale/Rationale/>MLIR Rationale</a></li><li><a href=https://mlir.llvm.org/docs/Rationale/MLIRForGraphAlgorithms/>MLIR: Incremental Application to Graph Algorithms in ML Frameworks</a></li><li><a href=https://mlir.llvm.org/docs/Rationale/RationaleSimplifiedPolyhedralForm/>MLIR: The case for a simplified polyhedral form</a></li><li><a href=https://mlir.llvm.org/docs/Rationale/SideEffectsAndSpeculation/>Side Effects & Speculation</a></li><li><a href=https://mlir.llvm.org/docs/Rationale/UsageOfConst/>Usage of 'const' in MLIR, for core IR types</a></li></ul></li><li><a href=https://mlir.llvm.org/docs/Remarks/>Remark Infrastructure</a></li><li><a href=https://mlir.llvm.org/docs/ShapeInference/>Shape Inference</a></li><li><a href=https://mlir.llvm.org/docs/SPIRVToLLVMDialectConversion/>SPIR-V Dialect to LLVM Dialect conversion manual</a></li><li><a href=https://mlir.llvm.org/docs/SymbolsAndSymbolTables/>Symbols and Symbol Tables</a></li><li><a href=https://mlir.llvm.org/docs/DeclarativeRewrites/>Table-driven Declarative Rewrite Rule (DRR)</a></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Traits/>Traits<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Traits/Broadcastable/>The `Broadcastable` Trait</a></li></ul></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Tutorials/>Tutorials<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Tutorials/CreatingADialect/>Creating a Dialect</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/QuickstartRewrites/>Quickstart tutorial to adding MLIR graph rewrite</a></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Tutorials/Toy/>Toy Tutorial<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Tutorials/Toy/Ch-1/>Chapter 1: Toy Language and AST</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/Toy/Ch-2/>Chapter 2: Emitting Basic MLIR</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/Toy/Ch-3/>Chapter 3: High-level Language-Specific Analysis and Transformation</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/Toy/Ch-4/>Chapter 4: Enabling Generic Transformation with Interfaces</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/Toy/Ch-5/>Chapter 5: Partial Lowering to Lower-Level Dialects for Optimization</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/Toy/Ch-6/>Chapter 6: Lowering to LLVM and CodeGeneration</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/Toy/Ch-7/>Chapter 7: Adding a Composite Type to Toy</a></li></ul></li><li class=has-sub-menu><a href=https://mlir.llvm.org/docs/Tutorials/transform/>Transform Dialect Tutorial<span class="mark closed">+</span></a><ul class=sub-menu><li><a href=https://mlir.llvm.org/docs/Tutorials/transform/Ch0/>Chapter 0: A Primer on “Structured” Linalg Operations</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/transform/Ch1/>Chapter 1: Combining Existing Transformations</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/transform/Ch2/>Chapter 2: Adding a Simple New Transformation Operation</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/transform/Ch3/>Chapter 3: More than Simple Transform Operations</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/transform/Ch4/>Chapter 4: Matching Payload with Transform Operations</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/transform/ChH/>Chapter H: Reproducing Halide Schedule</a></li></ul></li><li><a href=https://mlir.llvm.org/docs/Tutorials/UnderstandingTheIRStructure/>Understanding the IR Structure</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/MlirOpt/>Using `mlir-opt`</a></li><li><a href=https://mlir.llvm.org/docs/Tutorials/DataFlowAnalysis/>Writing DataFlow Analyses in MLIR</a></li></ul></li></ul></li></ul></nav><div class=sidebar-footer></div></div></div><a href=# id=backtothetop-fixed class=backtothetop data-backtothetop-duration=600 data-backtothetop-easing=easeOutQuart data-backtothetop-fixed-fadein=1000 data-backtothetop-fixed-fadeout=1000 data-backtothetop-fixed-bottom=10 data-backtothetop-fixed-right=20><span class="fa-layers fa-fw"><i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i></span></a></div></body></html>